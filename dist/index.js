(()=>{"use strict";const e="https://server-test-task.onrender.com",t=(e,...t)=>{const n=document.createElement(e);return n.classList.add(...t),n},n=Array.from(document.getElementById("images_container").children),o=t=>{t.forEach(((t,o)=>{n[o].style.backgroundImage=`url(${e}/${t})`,n[o].style.backgroundSize="cover"}))},s=()=>{document.querySelector(".toast").remove()},a=(e,n)=>{const o=t("div","toast",n),a=t("p","toast__text");a.innerText+=e;const r=t("span","close-button");return r.addEventListener("click",s),o.append(a,r),setTimeout((()=>{o.remove()}),3e3),o},r=["image/jpeg","image/jpg","image/png","image/webp"],c=async e=>{const{width:t,height:n}=await async function(e){const t=new Image;t.src=window.URL.createObjectURL(e),await t.decode();const n=t.width,o=t.height;return t.onload=function(){window.URL.revokeObjectURL(this.src)},{width:n,height:o}}(e);return 1920===t&&1080===n},d=document.getElementById("bg-img"),i=document.getElementById("btn-left"),l=document.getElementById("btn-right"),u=document.getElementById("btn-up"),m=document.getElementById("btn-down");let g=0,h=0,y=[];window.onload=async function(){y=await(async()=>{const t=await fetch(`${e}/images`),{imagesList:n}=await t.json();return n})(),y.length?(o(y.slice(-3)),p(`url(${e}/${y[g]})`)):p("url('./assets/img/defaultBG.jpg')")};const p=e=>{d.firstElementChild.style.backgroundImage=e,d.firstElementChild.style.backgroundSize="cover"},f=(t,n)=>{if(y.length<=1)return;const o=document.querySelector(".background");o.classList.add(t);const s=document.createElement("div");s.classList.add("background",n),s.style.background=`url(${e}/${y[g]})`,s.style.backgroundSize="cover",d.append(s),setTimeout((()=>{if(o.remove(),s.classList="background",d.childNodes.length>1){const e=d.childNodes;for(let t=0;t<e.length-1;t++)e[t].remove()}}),3e3)},w=()=>{console.log("addDownClickHandler"),y.length<=1||(g=0===g?y.length-1:g-1,f("transition-to-down","transition-from-up"))};m.addEventListener("click",w);const v=()=>{y.length<=1||(g=g===y.length-1?0:g+1,f("transition-to-up","transition-from-down"))};u.addEventListener("click",v);const E=()=>{y.length<=1||(g=0===g?y.length-1:g-1,f("transition-to-right","transition-from-left"))};i.addEventListener("click",E);const b=()=>{y.length<=1||(g=g===y.length-1?0:g+1,f("transition-to-left","transition-from-right"))};l.addEventListener("click",b);const L=()=>{h=0};document.addEventListener("DOMContentLoaded",(()=>{setInterval((()=>{h++,h>=5&&h%5==0&&(g=y.length-1<=g?0:g+1,f("transition-to-up","transition-from-down"))}),1e3)})),document.addEventListener("mousemove",(()=>L())),document.addEventListener("scroll",(()=>L())),document.addEventListener("click",(()=>L())),document.addEventListener("keydown",(e=>{(e=>{y.length<=1||("ArrowRight"!==e.code?"ArrowLeft"!==e.code?"ArrowDown"!==e.code?"ArrowUp"!==e.code||v():w():E():b())})(e),L()}));const k=document.querySelector("#upload_file");k.addEventListener("change",(async t=>{const n=k.files[0];var s;if(s=n,!r.includes(s.type)){const e=a("Only images are allowed to upload","toast_error");return document.querySelector("body").append(e),void(t.target.value="")}if(!await c(n)){const e=a("The dimensions of the images should be  1920 * 1080","toast_error");return document.querySelector("body").append(e),void(t.target.value="")}const{responseStatus:d,message:i,fileName:l}=await(async t=>{const n=new FormData;n.append("image",t);try{const t=await fetch(`${e}/images`,{method:"POST",body:n}),o=t.status,{message:s,fileName:a}=await t.json();return{responseStatus:o,message:s,fileName:a}}catch(e){console.log("saveImage",e)}})(n);if(201===d){y.push(l),o(y.slice(-3)),1===y.length&&p(`url(${e}/${y[g]})`);const t=a(i,"toast_success");document.querySelector("body").append(t)}else{const e=a(i,"toast_error");document.querySelector("body").append(e)}t.target.value=""})),document.getElementById("clear_gallery").addEventListener("click",(async t=>{t.preventDefault();const{responseStatus:o,responseMessage:s}=await(async()=>{try{const t=await fetch(`${e}/images`,{method:"DELETE"});return{responseStatus:t.status,responseMessage:await t.text()}}catch(e){console.log("clearGallery",e)}})();if(200===o){const e=a(s,"toast_success");document.querySelector("body").append(e),y=[],n.forEach((e=>{e.style.backgroundImage=""})),p("url('./assets/img/defaultBG.jpg')")}else{const e=a(s,"toast_error");document.querySelector("body").append(e)}}))})();