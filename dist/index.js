(()=>{"use strict";const e="https://server-test-task.onrender.com",t=(e,...t)=>{const n=document.createElement(e);return n.classList.add(...t),n},n=Array.from(document.getElementById("images_container").children),o=t=>{t.forEach(((t,o)=>{n[o].style.backgroundImage=`url(${e}/${t})`,n[o].style.backgroundSize="cover"}))},s=()=>{document.querySelector(".toast").remove()},a=(e,n)=>{const o=t("div","toast",n),a=t("p","toast__text");a.innerText+=e;const r=t("span","close-button");return r.addEventListener("click",s),o.append(a,r),setTimeout((()=>{o.remove()}),3e3),o},r=["image/jpeg","image/jpg","image/png","image/webp"],c=document.getElementById("bg-img"),d=document.getElementById("btn-left"),i=document.getElementById("btn-right");let l=0,u=0,m=[];window.onload=async function(){m=await(async()=>{const t=await fetch(`${e}/images`),{imagesList:n}=await t.json();return n})(),m.length?(o(m.slice(-3)),c.firstElementChild.style.background=`url(${e}/${m[l]})`):c.firstElementChild.style.backgroundImage="url('./assets/img/defaultBG.jpg')"};const g=(t,n)=>{const o=document.querySelector(".background");o.classList.add(t);const s=document.createElement("div");s.classList.add("background",n),s.style.background=`url(${e}/${m[l]})`,s.style.backgroundSize="cover",c.append(s),setTimeout((()=>{if(o.remove(),s.classList="background",c.childNodes.length>1){const e=c.childNodes;for(let t=0;t<e.length-1;t++)e[t].remove()}}),3e3)},y=()=>{m.length<=1||(l=0===l?m.length-1:l-1,g("transition-to-down","transition-from-up"))};d.addEventListener("click",y);const h=()=>{m.length<=1||(l=l===m.length-1?0:l+1,g("transition-to-up","transition-from-down"))};i.addEventListener("click",h);const p=()=>{u=0};document.addEventListener("mousemove",(()=>p())),document.addEventListener("scroll",(()=>p())),document.addEventListener("click",(()=>p())),document.addEventListener("keydown",(e=>{(e=>{m.length<=1||("ArrowDown"!==e.code&&"ArrowRight"!==e.code?"ArrowLeft"!==e.code&&"ArrowUp"!==e.code||y():h())})(e),p()}));const f=document.querySelector("#upload_file");f.addEventListener("change",(async t=>{const n=f.files[0];var s;if(s=n,!r.includes(s.type)){const e=a("Only images are allowed to upload","toast_error");return document.querySelector("body").append(e),void(t.target.value="")}if(!await(async e=>{const{width:t,height:n}=await async function(e){const t=new Image;return t.src=URL.createObjectURL(e),await t.decode(),{width:t.width,height:t.height}}(e);return 1920===t&&1080===n})(n)){const e=a("The dimensions of the images should be  1920 * 1080","toast_error");return document.querySelector("body").append(e),void(t.target.value="")}const{responseStatus:d,message:i,fileName:u}=await(async t=>{const n=new FormData;n.append("image",t);try{const t=await fetch(`${e}/images`,{method:"POST",body:n}),o=t.status,{message:s,fileName:a}=await t.json();return{responseStatus:o,message:s,fileName:a}}catch(e){console.log("saveImage",e)}})(n);if(201===d){m.push(u),o(m.slice(-3)),1===m.length&&(c.firstElementChild.style.background=`url(${e}/${m[l]})`);const t=a(i,"toast_success");document.querySelector("body").append(t)}else{const e=a(i,"toast_error");document.querySelector("body").append(e)}t.target.value=""})),document.getElementById("clear_gallery").addEventListener("click",(async t=>{t.preventDefault();const{responseStatus:o,responseMessage:s}=await(async()=>{try{const t=await fetch(`${e}/images`,{method:"DELETE"});return{responseStatus:t.status,responseMessage:await t.text()}}catch(e){console.log("clearGallery",e)}})();if(200===o){const e=a(s,"toast_success");document.querySelector("body").append(e),m=[],n.forEach((e=>{e.style.backgroundImage=""})),c.firstElementChild.style.background="url('./assets/img/defaultBG.jpg')",c.firstElementChild.style.backgroundSize="cover"}else{const e=a(s,"toast_error");document.querySelector("body").append(e)}}))})();