(()=>{"use strict";const e="https://server-test-task.onrender.com",t=(e,...t)=>{const n=document.createElement(e);return n.classList.add(...t),n},n=Array.from(document.getElementById("images_container").children),s=t=>{t.forEach(((t,s)=>{n[s].style.backgroundImage=`url(${e}/${t})`,n[s].style.backgroundSize="cover"}))},a=()=>{document.querySelector(".toast").remove()},o=(e,n)=>{const s=t("div","toast",n),o=t("p","toast__text");o.innerText+=e;const r=t("span","close-button");return r.addEventListener("click",a),s.append(o,r),setTimeout((()=>{s.remove()}),3e3),s},r=["image/jpeg","image/jpg","image/png","image/webp"],c=document.getElementById("bg-img"),i=document.getElementById("btn-left"),d=document.getElementById("btn-right");let l=0,u=0,m=[];window.onload=async function(){m=await(async()=>{const t=await fetch(`${e}/images`),{imagesList:n}=await t.json();return n})(),m.length?(s(m.slice(-3)),c.firstChild.style.background=`url(${e}/${m[l]})`):c.firstChild.style.backgroundImage="url('./assets/img/defaultBG.jpg')"};const g=(t,n)=>{i.removeEventListener("click",y),d.removeEventListener("click",h);const s=document.querySelector(".background");s.classList.add(t);const a=document.createElement("div");a.classList.add("background",n),a.style.background=`url(${e}/${m[l]})`,a.style.backgroundSize="cover",c.append(a),setTimeout((()=>{s.remove(),a.classList="background",i.addEventListener("click",y),d.addEventListener("click",h)}),3e3)},y=()=>{m.length<=1||(l=0===l?m.length-1:l-1,g("transition-to-right","transition-from-left"))};i.addEventListener("click",y);const h=()=>{m.length<=1||(l=l===m.length-1?0:l+1,g("transition-to-left","transition-from-right"))};d.addEventListener("click",h);const p=()=>{u=0};document.addEventListener("DOMContentLoaded",(()=>{setInterval((()=>{u++,u>=15&&u%5==0&&(l=l===m.length-1?0:l+1,g("transition-to-left","transition-from-right"))}),1e3)})),document.addEventListener("mousemove",(()=>p())),document.addEventListener("scroll",(()=>p())),document.addEventListener("click",(()=>p())),document.addEventListener("keypress",(()=>p()));const v=document.querySelector("#upload_file");v.addEventListener("change",(async t=>{const n=v.files[0];var a;if(a=n,!r.includes(a.type)){const e=o("Only images are allowed to upload","toast_error");return document.querySelector("body").append(e),void(t.target.value="")}if(!await(async e=>{const{width:t,height:n}=await async function(e){const t=new Image;return t.src=URL.createObjectURL(e),await t.decode(),{width:t.width,height:t.height}}(e);return 1920===t&&1080===n})(n)){const e=o("The dimensions of the images should be  1920 * 1080","toast_error");return document.querySelector("body").append(e),void(t.target.value="")}const{responseStatus:i,message:d,fileName:u}=await(async t=>{const n=new FormData;n.append("image",t);try{const t=await fetch(`${e}/images`,{method:"POST",body:n}),s=t.status,{message:a,fileName:o}=await t.json();return{responseStatus:s,message:a,fileName:o}}catch(e){console.log("saveImage",e)}})(n);if(201===i){m.push(u),s(m.slice(-3)),1===m.length&&(c.firstChild.style.background=`url(${e}/${m[l]})`);const t=o(d,"toast_success");document.querySelector("body").append(t)}else{const e=o(d,"toast_error");document.querySelector("body").append(e)}t.target.value=""})),document.getElementById("clear_gallery").addEventListener("click",(async t=>{t.preventDefault();const{responseStatus:s,responseMessage:a}=await(async()=>{try{const t=await fetch(`${e}/images`,{method:"DELETE"});return{responseStatus:t.status,responseMessage:await t.text()}}catch(e){console.log("clearGallery",e)}})();if(200===s){const e=o(a,"toast_success");document.querySelector("body").append(e),m=[],n.forEach((e=>{e.style.backgroundImage=""})),c.firstChild.style.background="url('./assets/img/defaultBG.jpg')",c.firstChild.style.backgroundSize="cover"}else{const e=o(a,"toast_error");document.querySelector("body").append(e)}}))})();